install.packages("dplyr")
install.packages("tidyr")
install.packages("ggmap")
install.packages("sp")
install.packages("mapview")
library(dplyr)
library(tidyr)
library(ggmap)
library(sp)
library(mapview)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
head(Diversity)
#Select all data about China
China <- filter(Diversity, Country=="China")
China
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#How many sources about China
Source_ID <- select(China, Source_ID, Country)
China_Unique <- unique(Source_ID, incomparables = FALSE)
China_Unique
# 38 source about China
nrow(China_Unique)
#Plot source location in China
coordinates(China) <- ~ Longitude + Latitude
proj4string(China) <- CRS("+init=epsg:4326")
mapview(China)
#Plot source location in China
coordinates(China) <- ~ lon + lat
proj4string(China) <- CRS("+init=epsg:4326")
mapview(China)
Longitude
#Plot source location in China
coordinates(China) <- ~ Longitude + Latitude
proj4string(China) <- CRS("+init=epsg:4326")
mapview(China)
install.packages("dplyr")
install.packages("tidyr")
install.packages("ggmap")
install.packages("sp")
install.packages("mapview")
library(dplyr)
library(tidyr)
library(ggmap)
library(sp)
library(mapview)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
head(Diversity)
#Select all data about China
China <- filter(Diversity, Country=="China")
View(China_Unique)
#How many sources about China
Source_ID <- select(China, Source_ID, Country)
China_Unique <- unique(Source_ID, incomparables = FALSE)
China_Unique
# 38 source about China
nrow(China_Unique)
#Plot source location in China
coordinates(China) <- ~ Longitude + Latitude
proj4string(China) <- CRS("+init=epsg:4326")
mapview(China)
table (China$Predominant_habitat)
View(China)
("diversity-2021-07-12-02-32-53.rds")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
head(Diversity)
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#Select arthropoda data in China
China <- filter(Arthropoda, Country=="China")
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
View(Diversity)
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
install.packages("dplyr")
install.packages("tidyr")
install.packages("ggmap")
install.packages("sp")
install.packages("mapview")
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
head(Diversity)
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#Select all data about Arthropoda
Arthropoda <- Select (Diversity, Phylum == "Arthropoda")
#Select all data about Arthropoda
Arthropoda <- filter(Diversity, Phylum == "Arthropoda")
View(Diversity)
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")%>% filter(Diversity, Country=="China")
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda") %>% filter(Diversity, Country=="China")
install.packages(“dplyr”)
install.packages("dplyr")
library(dplyr)
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda") %>% filter(Diversity, Country=="China")
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda") %>% filter(Diversity, Country=="China")
rlang::last_error()
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select all data about Arthropoda
Arthropoda <- filter (Diversity, Phylum == "Arthropoda")
#Select Arthropoda data in China
Arthropoda_China <- filter(Arthropoda, Country=="China")
View(Arthropoda_China)
nrow(Arthropoda_China)
Arthropoda_China_UniqueSS <- unique(SS, incomparables = FALSE)
View(Arthropoda_China)
table(Arthropoda_China$Predominant_habitat)
table(Arthropoda_China$Predominant_habitat)
head(Arthropoda_China)
install.packages("dplyr")
install.packages("tidyr")
install.packages("ggmap")
install.packages("sp")
install.packages("mapview")
install.packages("dplyr")
install.packages("lme4")
library(dplyr)
library(tidyr)
library(ggmap)
library(sp)
library(mapview)
library(lme4)
install.packages("dplyr")
install.packages("tidyr")
install.packages("magrittr")
install.packages("lme4")
install.packages("car")
install.packages("raster")
install.packages("geosphere")
install.packages("foreach")
install.packages("doParallel")
library(dplyr) # for easy data manipulation
library(tidyr) # ditto
library(magrittr) # for piping
library(lme4) # for mixed effects models
install.packages("dplyr")
library(car) # for logit transformation with adjustment
library(raster) # for working with raster data
library(geosphere) # calculating geographic distance between sites
library(foreach) # running loops
library(doParallel) # running loops in parallel
install.packages("dplyr")
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Arthropoda data in China and Brazil
CB_Arthropoda <- filter(Arthropoda, Country == "China"| Country =="Brazil")
#Select Arthropoda data in China and Brazil
CB_Diver <- filter(Diversity, Country == "China"| Country =="Brazil")
install.packages("Rcpp")
library(Rcpp)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Arthropoda data in China
C_Diver <- filter(Diversity, Country == "China" & Class == "Insecta")
install.packages("dplyr")
install.packages("tidyr")
install.packages("magrittr")
install.packages("lme4")
install.packages("car")
install.packages("raster")
install.packages("geosphere")
install.packages("foreach")
install.packages("doParallel")
install.packages("Rcpp")
library(dplyr) # for easy data manipulation
library(tidyr) # ditto
library(magrittr) # for piping
library(lme4) # for mixed effects models
library(car) # for logit transformation with adjustment
library(raster) # for working with raster data
library(geosphere) # calculating geographic distance between sites
library(foreach) # running loops
library(doParallel) # running loops in parallel
library(Rcpp)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Arthropoda data in China
C_Diver <- filter(Diversity, Country == "China" & Class == "Insecta")
NC_Diver <- C_Diver %>%
# make a level of Primary minimal. Everything else gets the coarse land use
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
#Select Arthropoda data in China
C_Diver <- filter(Diversity, Country == "China" & Class == "Insecta")
#Select Insecta data
Insecta <- filter(Diversity,Class == "Insecta")
install.packages("dplyr")
install.packages("tidyr")
install.packages("magrittr")
install.packages("lme4")
install.packages("car")
install.packages("raster")
install.packages("geosphere")
install.packages("foreach")
install.packages("doParallel")
install.packages("Rcpp")
library(dplyr) # for easy data manipulation
library(tidyr) # ditto
library(magrittr) # for piping
library(lme4) # for mixed effects models
library(car) # for logit transformation with adjustment
library(raster) # for working with raster data
library(geosphere) # calculating geographic distance between sites
library(foreach) # running loops
library(doParallel) # running loops in parallel
library(Rcpp)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Insecta data
Insecta <- filter(Diversity,Class == "Insecta")
NC_Diver <- C_Diver %>% Country == "China" &
# make a level of Primary minimal. Everything else gets the coarse land use
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
CB_Diver <- filter(Insecta,Country == "China" |Insecta,Country == "Brazil" )
CB_Diver <- filter(Insecta,Country == "China" |Country == "Brazil" )
# make a level of Primary minimal. Everything else gets the coarse land use
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
diversity
diversity <- CB_Diver %>%
# make a level of Primary minimal. Everything else gets the coarse land use
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
table(diversity$LandUse)
#Calculate BII
abundance_data <- diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS)
ab_m <- lmer(log(TotalAbundance) ~ LandUse + (1|SS) + (1|SSB), data = abundance_data)
ab_m <- lmer(log(TotalAbundance) ~ LandUse + Country + (1|SS) + (1|SSB), data = abundance_data)
ab_m <- lmer(log(TotalAbundance) ~ LandUse + Country + (1|SS) + (1|SSB), abundance_data)
View(abundance_data)
mutate(abundance_data, logTotalAbundance = log(TotalAbundance))
View(abundance_data)
ab_m <- lmer(logTotalAbundance ~ LandUse + Country + (1|SS) + (1|SSB), abundance_data)
ab_m <- lmer(log(TotalAbundance) ~ LandUse + Country + (1|SS) + (1|SSB), abundance_data)
ab_m <- lmer(TotalAbundance ~ LandUse + Country + (1|SS) + (1|SSB), abundance_data)
ab_m <- lmer(TotalAbundance ~ LandUse + Country + (1|SS) + (1|SSB), abundance_data)
?isSingular
ab_m <- lmer(TotalAbundance ~ LandUse + (1|SS), abundance_data)
summary(ab_m)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Insecta data
Insecta <- filter(Diversity,Class == "Insecta")
C_Diver <- filter(Insecta,Country == "China")
B_Diver <- filter(Insecta,Country == "Brazil")
C_diversity <- CB_Diver %>%
# make a level of Primary minimal. Everything else gets the coarse land use
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
C_diversity <- C_Diver %>%
# make a level of Primary minimal. Everything else gets the coarse land use
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Insecta data
Insecta <- filter(Diversity,Class == "Insecta")
diversity <- Insecta %>%
# Combine primary and secondary vegatation together as natural vegetation
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural vegetation")
)
C_diversity <- filter(diversity,Country == "China")
B_diversity <- filter(diversity,Country == "Brazil")
table(C_diversity$LandUse)
table(B_diversity$LandUse)
#Calculate BII for China
C_abundance_data <- C_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS)
#Calculate BII for Brazil
B_abundance_data <- B_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS)
ab_m <- lmer(TotalAbundance ~ LandUse + (1|SS), C_abundance_data)
C_lm <- lmer(TotalAbundance ~ LandUse + (1|SS), C_abundance_data)
View(ab_m)
B_lm <- lmer(TotalAbundance ~ LandUse + (1|SS), B_abundance_data)
summary(C_lm)
summary(B_lm)
source(“http://www.highstat.com/Book2/HighstatLibV6.R”).
source(“http://www.highstat.com/Book2/HighstatLibV6.R”)
source(“http://www.highstat.com/Book2/HighstatLibV6.R”)
table(Insecta$Predominant_habitat)
