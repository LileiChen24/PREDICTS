Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural and Semi-Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural and Semi-Natural vegetation")
)
#Calculate rescale totalabundance
abundance_data <- diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(RescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Select Insecta data
Insecta_diversity <- filter(Diversity, Class == "Insecta")
#Select country in China and Brazil
Insecta_diversity_China_Brazil <- filter(Insecta_diversity, Country == "Brazil"|Country == "China")
#Combine primary and secondary vegetation
diversity <- Insecta_diversity_China_Brazil %>%
# Combine primary and secondary vegatation together as natural vegetation
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural and Semi-Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural and Semi-Natural vegetation")
)
#Calculate rescale totalabundance
abundance_data <- diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(RescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
View(diversity)
#Check the Diversity_metric_type
table(diversity$Diversity_metric_type)
hist(abundance_data$RescaledAbundance)
plot(abundance_data$RescaledAbundance)
qqnorm(abundance_data$RescaledAbundance)
plot(abundance_data$RescaledAbundance)
hist(abundance_data$RescaledAbundance)
plot(abundance_data$RescaledAbundance)
qqnorm(abundance_data$RescaledAbundance)
#Mixed linear model for Insecta abundance data in China and Brazil
abun_lm <- lmer(RescaledAbundance ~ (LandUse + Use_intensity)* Country + (1|SS), abundance_data)
summary(abun_lm)
print(x, correlation=TRUE)
summary(abun_lm, vcov(x))
summary(abun_lm)
anova(abun_lm)
anova(abun_lm, test = "F")
sjPlot::plot_model(abun_lm)
summary(abun_lm, x, correlation=TRUE)
summary(abun_lm,correlation=TRUE)
summary(abun_lm, correlation=TRUE)
sjPlot::plot_model(abun_lm)
anova(abun_lm)
#Calculate rescale totalabundance
abundance_data <- diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
#Check the Diversity_metric_type
table(diversity$Diversity_metric_type)
hist(abundance_data$logRescaledAbundance)
plot(abundance_data$logRescaledAbundance)
qqnorm(abundance_data$logRescaledAbundance)
#Mixed linear model for Insecta abundance data in China and Brazil
abun_lm <- lmer(logRescaledAbundance ~ (LandUse + Use_intensity)* Country + (1|SS), abundance_data)
summary(abun_lm, correlation=TRUE)
anova(abun_lm)
#Respectively select data in China and Brazil
China_Insecta_diversity <- filter(Insecta_diversity, Country == "China")
Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Combine primary and secondary vegetation
relevel_diversity <- Diversity %>%
# Combine primary and secondary vegatation together as natural vegetation
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural and Semi-Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural and Semi-Natural vegetation")
)
#Select Insecta data
Insecta_diversity <- filter(relevel_diversity, Class == "Insecta")
#Respectively select data in China and Brazil
China_Insecta_diversity <- filter(Insecta_diversity, Country == "China")
Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil")
#Select data in China and Brazil
China_Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil"|Country == "China")
#Calculate rescale totalabundance
China_abundance_data <- China_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
#Calculate rescale totalabundance for Brazil
Brazil_abundance_data <- Brazil_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
#Check the Diversity_metric_type
hist(Brazil_abundance_data$logRescaledAbundance)
View(Brazil_abundance_data)
#Check the Diversity_metric_type
hist(China_abundance_data$logRescaledAbundance)
plot(China_abundance_data$logRescaledAbundance)
qqnorm(China_abundance_data$logRescaledAbundance)
#Mixed linear model for Insecta abundance data in China and Brazil
China_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), China_abundance_data)
summary(China_abun_lm)
anova(abun_lm)
anova(China_abun_lm)
sjPlot::plot_model(China_abun_lm)
Brazil_abun_lm <- lmer(RescaledAbundance ~ LandUse + Use_intensity + (1|SS), Brazil_abundance_data)
Brazil_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), Brazil_abundance_data)
summary(Brazil_abun_lm)
anova(Brazil_abun_lm)
sjPlot::plot_model(Brazil_abun_lm)
#Mixed linear model for Insecta abundance data in China and Brazil
China_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), China_abundance_data)
Brazil_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), Brazil_abundance_data)
summary(China_abun_lm)
summary(Brazil_abun_lm)
anova(China_abun_lm)
anova(Brazil_abun_lm)
sjPlot::plot_model(China_abun_lm)
sjPlot::plot_model(Brazil_abun_lm)
sjPlot::plot_model(China_abun_lm)
sjPlot::plot_model(Brazil_abun_lm)
plot(China_abundance_data)
plot(ranef(China_abun_lm))
plot(ranef(Brazil_abun_lm))
plot(Brazil_abun_lm)
plot(China_abun_lm)
#Set working directory
setwd("F:/Code_PREDICTS/data")
#Read rds file
Diversity <- readRDS("diversity-2021-07-21-02-32-58.rds")
#Combine primary and secondary vegetation
relevel_diversity <- Diversity %>%
# Combine primary and secondary vegatation together as natural vegetation
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural and Semi-Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural and Semi-Natural vegetation")
)
#Select Insecta data
Insecta_diversity <- filter(relevel_diversity, Class == "Insecta")
#Respectively select data in China and Brazil
China_Insecta_diversity <- filter(Insecta_diversity, Country == "China")
Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil")
#Select data in China and Brazil
China_Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil"|Country == "China")
#Calculate rescale totalabundance
China_abundance_data <- China_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
#Calculate rescale totalabundance for Brazil
Brazil_abundance_data <- Brazil_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
hist(China_abundance_data$logRescaledAbundance)
plot(China_abundance_data$logRescaledAbundance)
qqnorm(China_abundance_data$logRescaledAbundance)
hist(Brazil_abundance_data$logRescaledAbundance)
plot(Brazil_abundance_data$logRescaledAbundance)
qqnorm(Brazil_abundance_data$logRescaledAbundance)
#Mixed linear model for Insecta abundance data in China and Brazil
China_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), China_abundance_data)
Brazil_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), Brazil_abundance_data)
summary(China_abun_lm)
summary(Brazil_abun_lm)
anova(China_abun_lm)
anova(Brazil_abun_lm)
sjPlot::plot_model(China_abun_lm)
sjPlot::plot_model(Brazil_abun_lm)
View(China_abun_lm)
View(China_abundance_data)
table(China_abundance_data$Source_ID)
table(unique(China_abundance_data$Source_ID))
table(unique(China_abundance_data$Source_ID))
table(China_abundance_data$SS)
unique(China_abundance_data,SS)
unique(China_abundance_data$SS)
Study_China <- unique(China_abundance_data$SS)
Study_China <- unique(China_abundance_data$Study_number)
Study_China
Study_China <- unique(China_abundance_data$Study_name)
Study_China
Study_China <- unique(China_abundance_data$SS)
Study_China
Study_China <- unique(China_abundance_data$SSb)
Study_China
Study_China <- unique(China_abundance_data$SSB)
Study_China
Study_China <- unique(China_abundance_data$SSS)
Study_China
Study_China <- unique(China_abundance_data$SS)
Study_China
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Read rds file
Diversity <- readRDS("diversity-2021-07-12-02-32-53.rds")
#Combine primary and secondary vegetation
relevel_diversity <- Diversity %>%
# Combine primary and secondary vegatation together as natural vegetation
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural and Semi-Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural and Semi-Natural vegetation")
)
#Select Insecta data
Insecta_diversity <- filter(relevel_diversity, Class == "Insecta")
#Respectively select data in China and Brazil
China_Insecta_diversity <- filter(Insecta_diversity, Country == "China")
unique(China_Insecta_diversity$SS)
#Read rds file
Diversity <- readRDS("diversity-2021-07-21-02-32-58.rds")
#Combine primary and secondary vegetation
relevel_diversity <- Diversity %>%
# Combine primary and secondary vegatation together as natural vegetation
mutate(
LandUse = ifelse(Predominant_habitat == "Primary forest" |
Predominant_habitat == "Primary non-forest" |
Predominant_habitat == "Young secondary vegetation"|
Predominant_habitat == "Intermediate secondary vegetation"|
Predominant_habitat == "Mature secondary vegetation"|
Predominant_habitat == "Secondary vegetation (indeterminate age)",
"Natural and Semi-Natural vegetation",
paste(Predominant_habitat)),
# change cannot decide into NA
LandUse = ifelse(Predominant_habitat == "Cannot decide",
NA,
paste(LandUse)),
# relevel the factor so that Natural vegetation is the first level (so that it is the intercept term in models)
LandUse = factor(LandUse),
LandUse = relevel(LandUse, ref = "Natural and Semi-Natural vegetation")
)
#Select Insecta data
Insecta_diversity <- filter(relevel_diversity, Class == "Insecta")
#Respectively select data in China and Brazil
China_Insecta_diversity <- filter(Insecta_diversity, Country == "China")
unique(China_Insecta_diversity$SS)
table(China_Insecta_diversity$Predominant_habitat)
Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil")
unique(Brazil_Insecta_diversity$SS)
table(Brazil_Insecta_diversity$Predominant_habitat)
table(China_Insecta_diversity$Predominant_habitat)
table(Brazil_Insecta_diversity$Predominant_habitat)
#Select data in China and Brazil
China_Brazil_Insecta_diversity <- filter(Insecta_diversity, Country == "Brazil"|Country == "China")
table(China_Brazil_Insecta_diversity$Predominant_habitat)
#Calculate rescale totalabundance
China_abundance_data <- China_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
#Calculate rescale totalabundance for Brazil
Brazil_abundance_data <- Brazil_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
hist(China_abundance_data$logRescaledAbundance)
plot(China_abundance_data$logRescaledAbundance)
qqnorm(China_abundance_data$logRescaledAbundance)
hist(Brazil_abundance_data$logRescaledAbundance)
plot(Brazil_abundance_data$logRescaledAbundance)
qqnorm(Brazil_abundance_data$logRescaledAbundance)
#Mixed linear model for Insecta abundance data in China and Brazil
China_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), China_abundance_data)
Brazil_abun_lm <- lmer(logRescaledAbundance ~ LandUse + Use_intensity + (1|SS), Brazil_abundance_data)
summary(China_abun_lm)
summary(Brazil_abun_lm)
anova(China_abun_lm)
anova(Brazil_abun_lm)
sjPlot::plot_model(China_abun_lm)
sjPlot::plot_model(Brazil_abun_lm)
tab(China_abun_lm)
table(China_abun_lm)
#Calculate rescale totalabundance for Brazil
China_Brazil_abundance_data <- China_Brazil_Insecta_diversity  %>%
# pull out just the abundance measures
filter(Diversity_metric_type == "Abundance") %>%
# group by SSBS (each unique value corresponds to a unique site)
group_by(SSBS) %>%
# now add up all the abundance measurements within each site
mutate(TotalAbundance = sum(Measurement)) %>%
# ungroup
ungroup() %>%
# pull out unique sites
distinct(SSBS, .keep_all = TRUE) %>%
# now group by Study ID
group_by(SS) %>%
# pull out the maximum abundance for each study
mutate(MaxAbundance = max(TotalAbundance)) %>%
# ungroup
ungroup() %>%
# now rescale total abundance, so that within each study, abundance varies from 0 to 1.
mutate(logRescaledAbundance = log(1 + TotalAbundance/MaxAbundance))
China_Brazil_abun_lm <- lmer(logRescaledAbundance ~ (LandUse + Use_intensity)* Country + (1|SS), China_Brazil_abundance_data)
hist(China_Brazil_abun_lm$logRescaledAbundance)
plot(China_Brazil_abun_lm$logRescaledAbundance)
hist(China_Brazil_abun_lm$logRescaledAbundance)
hist(China_Brazil_abun_lm$logRescaledAbundance)
plot(China_abundance_data$logRescaledAbundance)
qqnorm(China_abundance_data$logRescaledAbundance)
hist(Brazil_abundance_data$logRescaledAbundance)
plot(Brazil_abundance_data$logRescaledAbundance)
qqnorm(Brazil_abundance_data$logRescaledAbundance)
hist(China_Brazil_abun_lm$logRescaledAbundance)
plot(China_Brazil_abun_lm$logRescaledAbundance)
qqnorm(China_Brazil_abun_lm$logRescaledAbundance)
summary(China_Brazil_abun_lm)
anova(China_Brazil_abun_lm)
sjPlot::plot_model(China_Brazil_abun_lm)
summary(China_abun_lm)
summary(Brazil_abun_lm)
table(China_Brazil_Insecta_diversity$Diversity_metric_type)
table(China_Insecta_diversity$Predominant_habitat)
#Check how many unique SS in the data
unique(China_Insecta_diversity$SSBS)
#Check how many unique SS in the data
unique(China_Insecta_diversity$SS)
